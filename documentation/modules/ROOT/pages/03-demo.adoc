= Solution Pattern: Name Template
:sectnums:
:sectlinks:
:doctype: book
:page-toclevels: 3

= See the Solution in Action

== Demonstration

Demo is split into two parts:

* Bootstrapping ODF Multicloud GitOps Part 1 : This video demonstrates Hub Cluster setup, ArgoCD deployment and import of the existing openshift clusters. Once clusters are imported, these managed clusters will be managed by RedHat ACM.

* Bootstrapping ODF Mutlicloud GitOps Part 2 - AWS, GCP and Azure : This video demonstrates ODF installation on Hub as well as Managed clusters and RedHat Quay installation on the Hub Cluster.

[#demo-video]
=== Watch a demonstration

Bootstrapping ODF Multicloud GitOps Part 1

video::vLgpsfsA-9k[youtube, width=800, height=480]

Bootstrapping ODF Mutlicloud GitOps Part 2 - AWS, GCP and Azure

video::Tl0-3Xqgu84[youtube, width=800, height=480]


== Run the demonstration

=== Before getting started
To run this demo, we will need the following:

* An Openshift cluster to be used as Hub Cluster(We are using Openshift Cluster deployed on AWS). 
* A second OpenShift cluster to be imported and managed by Hub Cluster(Cluster can be in GCP or Azure).
* Helm

=== Installing the demo
We will need the following tools to deploy the demo:

* make
* sh
* oc 
* git
* ansible 
* kubernetes.core collection for ansible

To check if you have the cli tools, you can open your terminal and use following commands:

[.console-input]
[source,shell script]
```
oc version
make --version
git version
ansible --version 
ansible-galaxy --version 
ansible-galaxy collection list #the list should include kubernetes.core
```

If you can't see `kubernetes.core` collection listed, you can install it with `ansible-galaxy`:

[.console-input]
[source,shell script]
```
$ ansible-galaxy collection install kubernetes.core
```

Detailed instructions to run the demo:

Below instructions are split into two main parts: 1. Setup Hub Cluster in Openshift cluster running in AWS. 2. Import Openshift cluster running in Azure to be managed by RedHat ACM in Hub Cluster.

1. Fork https://github.com/gmidha/multicloud-gitops/tree/odf on GitHub. Code resides in odf branch
1. Clone the forked copy of the above repo
+
[.console-input]
[source,shell script]
```
git clone git@github.com:{username}/multicloud-gitops.git
```
+
1. Change into directory multicloud-gitops and ensure that you are in odf branch
+
[.console-input]
[source,shell script]
```
cd multicloud-gitops
git checkout odf
```
+
1. Login into Openshift cluster using oc login or exporting the KUBECONFIG.
+
[.console-input]
[source,shell script]
```
oc login
```
+
1. Apply changes to the cluster using below command
+
[.console-input]
[source,shell script]
```
make install
```
+
1. After 5 minutes on completion of above command, login into Openshift UI using a web browser and check the installed operators. Following Operators will be installed:
* RedHat ACM
* RedHat ODF
* RedHat Openshift GitOps
* RedHat Quay
+
[link=Operators.png, window="_blank"]
image::Operators.png[width=100%]
+
1. Using above steps our Hub Cluster setup has been done, we will be importing an Openshift cluster running in Azure cloud.
+
1. Using the below command get the HOST for RedHat ACM and open it in a web browser.
+
[.console-input]
[source,shell script]
```
oc get route -n open-cluster-management 
```
+
[link=RHACM_Host.png, window="_blank"]
image::RHACM_Host.png[width=100%]
+
[link=RHACM_UI.png, window="_blank"]
image::RHACM_UI.png[width=100%]
+
1. Now in RedHat ACM UI, under clusters view click on "Import Cluster" and enter the following values in the corresponding fields:
* Name: azure-cluster
* Additional Labels: clusterGroup=azure
* Click on "Save import and generate code"
+
[link=RHACM_Import.png, window="_blank"]
image::RHACM_Import.png[width=100%]
+
1. RedHat ACM will generate the command, click on "Copy command" to copy the command.
+
[link=RHACM_Copy.png, window="_blank"]
image::RHACM_Copy.png[width=100%]
+
1. Login into Azure Openshift cluster using oc login or exporting the KUBECONFIG in a separate terminal.
+
1. Run the copied command in the latest terminal where we logged in Azure Openshift cluster. Once executed successfully, it will show the below output.
+
[link=Azure_cli.png, window="_blank"]
image::Azure_cli.png[width=100%]
+
1. Check RedHat ACM UI and Azure Cluster will be marked as ready under clusters. 
+
[link=Azure_Imported.png, window="_blank"]
image::Azure_Imported.png[width=100%]
+
1. We have imported Azure Openshift cluster successfully and it will be managed by RedHat ACM now.

MultiCloud GitOps Flow:
This flow displays how different components are getting deployed and where are these getting deployed. ArgoCD is a critical component of the architecture. A policy on RedHat ACM ensures all the managed clusters have their own ArgoCD deployed through an Openshift GitOps operator. ArgoCD on a managed cluster uses GitHub repo to deploy the applications.

[link=MultiCloudGitOpsflow_1.jpg, window="_blank"]
image::MultiCloudGitOpsflow_1.jpg[width=100%]


=== Walkthrough guide

How to run through the demo
